# 레이스 컨디션(Race Condition) 이란 ?
* 둘 이상의 스레드가 공유 데이터에 액세스할 수 있고 동시에 변경하려고 할 때 발생하는 문제

  * 둘 이상의 스레드 : 요청
  * 공유 데이터 : 재고 데이터
  * 동시에 변경하려고 할 때 : 업데이트 할때
  * 발생하는 문제 : 값이 정상적으로 바뀌지 않는 문제


* 해결방법
  * 하나의 스레드만 데이터에 액세스 할 수 있도록 한다.


# 동시성 문제 해결

## 1. java synchronized 
### synchronized 문제점 1. - @Transactional
* `스프링 @Transactional 동작 방식 때문`
* 작성한 클래스를 매핑한 클래스를 새로 만듬. ex. StockService를 필드로 가지는 클래스를 새로 만들어서 메소드가 호출될 때 트랜잭션 시작시키고, 메소드 실행, 트랜잭션 종료
* 트랜잭션 종료 시점에 데이터베이스 업데이트한다. 이때 문제가 발생한다.
* `메소드가 완료되고 데이터 베이스 업데이트 전에 다른 쓰레드가 갱신 이전 데이터에 접근할 수 있음.` 
  * 따라서 이전과 동일한 문제가 생김.
  * 해결하는 방법에는 여러 방법이 있지만, 여기서는 @Transactional 주석 처리함. -> 테스트케이스 정상적으로 실행됨. 

### synchronized 문제점 2
* 하나의 프로세스 안에서만 보장이 된다. 
* 서버가 1대일 때는 가능하나 여러 대의 서버를 사용하게 되면 동시성 문제가 여전히 발생한다.
* 실무에서는 대부분 서버를 2대 이상 사용하기 때문에 synchronized로 Race Condition 문제를 해결하는 것은 좋지 못한 방법이다.
